<!-- templates/sig/view_all_properties.html -->
<!DOCTYPE html>
<html>
<head>
    <title>View All Geographical Properties</title>
    <!-- Agregar las referencias a los archivos de Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <!-- Agregar las referencias a los archivos de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        /* Agregar un estilo para el contenedor del mapa */
        #map {
            height: 60vh;
            margin-top: 20px;
        }
        th {
            width : 35%;
        }
        .card-container{
            display: flex;
            max-width:100%;
        }
    </style>
</head>
<body>
    <pre id="json-data" style="display:none;">{{ dataState|safe }}</pre>
    <!-- Agrega una sección para mostrar los nombres en una tabla -->
    {% load static %}

    
    <div class="container mt-5">
        <h2>DATOS GENERALES DEL INMUEBLE SEGÚN DOCUMENTACION</h2>
        <table class="table table-bordered">
            <tbody>
                {% for campo, valor in dataInmueble.datosGenerales.items %}
                <tr>
                    <th>{{ campo|title }}</th>
                    <td>{{ valor }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="container mt-5">
        <h2>DATOS GENERALES DEL INMUEBLE REGISTRADA POR LA EMPRESA</h2>
        <table class="table table-bordered">
            <tbody>
                {% for campo, valor in dataInmueble.datosMedicion.items %}
                <tr>
                    <th>{{ campo|title }}</th>
                    <td>{{ valor }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="container">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3">
            {% for caption, image_url in dataInmueble.imagenes.items %}
                <div class="col mb-4">
                    <div class="card" style="width: 100%;">
                        <img class="card-img-top" src="{{ image_url }}" alt="{{ caption }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ caption }}</h5>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="container mt-5">
        <h2>Tipo</h2>
        <table class="table table-bordered">
            <tbody>
                {% for campo, valor in dataInmueble.tipo.items %}
                <tr>
                    <th>{{ campo|title }}</th>
                    <td>{{ valor }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Agregar un div para el mapa -->
    <div id="map" class="container mb-1"></div>
    
    <div class="container mt-5">
        <h2>Nota</h2>
        <p>{{ dataInmueble.Nota }}</p>
    </div>

    <script>
        let jsonElement = document.getElementById('json-data');
        let jsonText;
        jsonElement.textContent ? jsonText=jsonElement.textContent: console.log("Error al leer el JSON");
        const jsonObject = JSON.parse(jsonText);
        
        // Obtener las coordenadas del polígono
        const coordinates = jsonObject.geometry.coordinates[0];
    
        // Crear un array para almacenar las coordenadas en formato Leaflet
        var latlngs = [];
        for (var i = 0; i < coordinates.length; i++) {
            latlngs.push([coordinates[i][1], coordinates[i][0]]);
        }
    
        // Función para calcular el centro del conjunto de coordenadas
        function getCenter(coords) {
            let x = 0, y = 0, z = 0;
            let rad = Math.PI / 180; // <-- Mueve esta línea aquí
        
            coords.forEach(coord => {
                let latitude = coord[0], longitude = coord[1];
        
                let lat = latitude * rad;
                let lon = longitude * rad;
        
                let a = Math.cos(lat) * Math.cos(lon);
                let b = Math.cos(lat) * Math.sin(lon);
                let c = Math.sin(lat);
        
                x += a;
                y += b;
                z += c;
            });
        
            x /= coords.length;
            y /= coords.length;
            z /= coords.length;
        
            let lon = Math.atan2(y, x);
            let hyp = Math.sqrt(x * x + y * y);
            let lat = Math.atan2(z, hyp);
        
            return [lat / rad, lon / rad];
        }
        
    
        // Crear el mapa en el div con el ID 'map'
        var mymap = L.map('map', {
            minZoom: 5
        });
    
        // Ahora usa la función para obtener el centro del polígono
        let center = getCenter(latlngs);
        mymap.setView(center, 7);
    
        // Agregar una capa de mapa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mymap);
    
        // Agregar el polígono al mapa
        var polygon = L.polygon(latlngs, { color: 'red' }).addTo(mymap);
        
        // Inicialización del carrusel
        document.addEventListener('DOMContentLoaded', function () {
            var carouselElement = document.getElementById('carouselExampleIndicators');
            var carousel = new bootstrap.Carousel(carouselElement, {
                interval: 2000
            });
        });
    </script>
    
</body>
</html>

